<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fill-a-Pix</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 0; padding: 0; }
    #board { display: grid; margin: 20px auto; }
    .cell {
      width: 32px; height: 32px;
      border: 1px solid #888;
      line-height: 32px; font-weight: bold;
      user-select: none;
    }
    .filled { background: #333; color: #fff; }
  </style>
</head>
<body>
  <h1>Fill-a-Pix</h1>
  <div>
    <label>Rows: <input type="number" id="rows" value="10" min="5" max="30"></label>
    <label>Cols: <input type="number" id="cols" value="10" min="5" max="30"></label>
    <label>Density: <input type="number" id="density" value="0.5" min="0.1" max="0.9" step="0.1"></label>
    <button id="startBtn" type="button">Start</button>
  </div>
  <div id="status"></div>
  <div id="board"></div>
  <script>
    var rowsInput = document.getElementById('rows');
    var colsInput = document.getElementById('cols');
    var densityInput = document.getElementById('density');
    var startBtn = document.getElementById('startBtn');
    var statusElem = document.getElementById('status');
    var boardElem = document.getElementById('board');

    var rows = 0, cols = 0, density = 0.5;
    var solution = [], player = [], clues = [];

    startBtn.addEventListener('click', function () {
      rows = parseInt(rowsInput.value, 10) || 10;
      cols = parseInt(colsInput.value, 10) || 10;
      density = parseFloat(densityInput.value);
      if (isNaN(density)) density = 0.5;
      startGame();
    });

    function startGame() {
      statusElem.textContent = '';
      boardElem.innerHTML = '';
      boardElem.style.gridTemplateColumns = 'repeat(' + cols + ', 32px)';

      solution = [];
      for (var r = 0; r < rows; r++) {
        var srow = [];
        for (var c = 0; c < cols; c++) {
          srow.push(Math.random() < density ? 1 : 0);
        }
        solution.push(srow);
      }
      player = [];
      for (var r2 = 0; r2 < rows; r2++) {
        var prow = [];
        for (var c2 = 0; c2 < cols; c2++) {
          prow.push(0);
        }
        player.push(prow);
      }
      clues = computeClues();

      for (var rr = 0; rr < rows; rr++) {
        for (var cc = 0; cc < cols; cc++) {
          var div = document.createElement('div');
          div.className = 'cell';
          div.textContent = clues[rr][cc];
          (function (r3, c3) {
            div.addEventListener('click', function () { handleCell(r3, c3); });
          })(rr, cc);
          boardElem.appendChild(div);
        }
      }
    }

    function computeClues() {
      var arr = [];
      for (var r = 0; r < rows; r++) {
        var row = [];
        for (var c = 0; c < cols; c++) {
          var count = 0;
          for (var dr = -1; dr <= 1; dr++) {
            for (var dc = -1; dc <= 1; dc++) {
              var nr = r + dr, nc = c + dc;
              if (nr >= 0 && nr < rows && nc >= 0 && nc < cols) {
                if (solution[nr][nc]) count++;
              }
            }
          }
          row.push(count);
        }
        arr.push(row);
      }
      return arr;
    }

    function handleCell(r, c) {
      var idx = r * cols + c;
      var cell = boardElem.children[idx];
      if (player[r][c] === 0) {
        player[r][c] = 1;
        cell.className = 'cell filled';
        cell.textContent = '';
      } else {
        player[r][c] = 0;
        cell.className = 'cell';
        cell.textContent = clues[r][c];
      }
      checkSolved();
    }

    function checkSolved() {
      for (var r = 0; r < rows; r++) {
        for (var c = 0; c < cols; c++) {
          if (player[r][c] === 1 && solution[r][c] !== 1) return;
          if (player[r][c] !== 1 && solution[r][c] === 1) return;
        }
      }
      statusElem.textContent = 'Puzzle solved!';
    }
  </script>
</body>
</html>
