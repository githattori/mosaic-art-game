<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Minesweeper</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 0; padding: 0; }
    #board { display: grid; margin: 20px auto; }
    .cell {
      width: 32px; height: 32px;
      border: 1px solid #888;
      line-height: 32px; font-weight: bold;
      user-select: none;
    }
    .hidden { background: #ccc; }
    .revealed { background: #eee; }
    .mine { background: #f66; }
    .flagged { background: #fc6; }
  </style>
</head>
<body>
  <h1>Minesweeper</h1>
  <div>
    <label>Rows: <input type="number" id="rows" value="10" min="5" max="30"></label>
    <label>Cols: <input type="number" id="cols" value="10" min="5" max="30"></label>
    <button id="startBtn" type="button">Start</button>
    <button id="modeBtn" type="button" disabled>Flag Mode: Off</button>
  </div>
  <div id="status"></div>
  <div id="board"></div>
  <script>
    var rowsInput = document.getElementById('rows');
    var colsInput = document.getElementById('cols');
    var startBtn = document.getElementById('startBtn');
    var modeBtn = document.getElementById('modeBtn');
    var statusElem = document.getElementById('status');
    var boardElem = document.getElementById('board');

    var rows = 0, cols = 0, mines = 0;
    var cells = [];
    var flagMode = false;

    startBtn.addEventListener('click', function () {
      rows = parseInt(rowsInput.value, 10) || 10;
      cols = parseInt(colsInput.value, 10) || 10;
      mines = Math.floor(rows * cols * 0.15);
      startGame();
    });

    modeBtn.addEventListener('click', function () {
      flagMode = !flagMode;
      modeBtn.textContent = 'Flag Mode: ' + (flagMode ? 'On' : 'Off');
    });

    function startGame() {
      flagMode = false;
      modeBtn.textContent = 'Flag Mode: Off';
      modeBtn.disabled = false;
      statusElem.textContent = 'Mines: ' + mines;
      boardElem.innerHTML = '';

      cells = [];
      for (var r = 0; r < rows; r++) {
        var row = [];
        for (var c = 0; c < cols; c++) {
          row.push({ mine: false, adj: 0, revealed: false, flagged: false });
        }
        cells.push(row);
      }

      var placed = 0;
      while (placed < mines) {
        var rr = Math.floor(Math.random() * rows);
        var cc = Math.floor(Math.random() * cols);
        if (!cells[rr][cc].mine) {
          cells[rr][cc].mine = true;
          placed++;
          for (var dr = -1; dr <= 1; dr++) {
            for (var dc = -1; dc <= 1; dc++) {
              var nr = rr + dr, nc = cc + dc;
              if (nr >= 0 && nr < rows && nc >= 0 && nc < cols) {
                cells[nr][nc].adj += 1;
              }
            }
          }
        }
      }

      boardElem.style.gridTemplateColumns = 'repeat(' + cols + ', 32px)';
      for (var r2 = 0; r2 < rows; r2++) {
        for (var c2 = 0; c2 < cols; c2++) {
          var div = document.createElement('div');
          div.className = 'cell hidden';
          (function (rr2, cc2) {
            div.addEventListener('click', function () { handleCell(rr2, cc2); });
          })(r2, c2);
          cells[r2][c2].elem = div;
          boardElem.appendChild(div);
        }
      }
    }

    function handleCell(r, c) {
      var cell = cells[r][c];
      if (cell.revealed) return;
      if (flagMode) {
        cell.flagged = !cell.flagged;
        cell.elem.className = 'cell hidden ' + (cell.flagged ? 'flagged' : '');
        return;
      }
      if (cell.flagged) return;
      reveal(r, c);
    }

    function reveal(r, c) {
      var cell = cells[r][c];
      if (cell.revealed || cell.flagged) return;
      cell.revealed = true;
      if (cell.mine) {
        cell.elem.className = 'cell revealed mine';
        statusElem.textContent = 'Game Over!';
        showAll();
        return;
      }
      cell.elem.className = 'cell revealed';
      if (cell.adj > 0) {
        cell.elem.textContent = cell.adj;
      } else {
        for (var dr = -1; dr <= 1; dr++) {
          for (var dc = -1; dc <= 1; dc++) {
            var nr = r + dr, nc = c + dc;
            if (nr >= 0 && nr < rows && nc >= 0 && nc < cols) {
              reveal(nr, nc);
            }
          }
        }
      }
      checkWin();
    }

    function showAll() {
      for (var r = 0; r < rows; r++) {
        for (var c = 0; c < cols; c++) {
          var cell = cells[r][c];
          if (cell.mine) {
            cell.elem.className = 'cell revealed mine';
          } else if (!cell.revealed) {
            cell.elem.className = 'cell revealed';
            if (cell.adj > 0) cell.elem.textContent = cell.adj;
          }
        }
      }
    }

    function checkWin() {
      var ok = true;
      for (var r = 0; r < rows; r++) {
        for (var c = 0; c < cols; c++) {
          var cell = cells[r][c];
          if (!cell.mine && !cell.revealed) ok = false;
        }
      }
      if (ok) {
        statusElem.textContent = 'You Win!';
        showAll();
      }
    }
  </script>
</body>
</html>
