<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Minesweeper</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 0; padding: 0; }
    #board { display: grid; margin: 20px auto; }
    .cell {
      width: 32px; height: 32px;
      border: 1px solid #888;
      line-height: 32px; font-weight: bold;
      user-select: none;
    }
    .hidden { background: #ccc; }
    .revealed { background: #eee; }
    .mine { background: #f66; }
    .flagged { background: #fc6; }
  </style>
</head>
<body>
  <h1>Minesweeper</h1>
  <div>
    <label>Rows: <input type="number" id="rows" value="10" min="5" max="30"></label>
    <label>Cols: <input type="number" id="cols" value="10" min="5" max="30"></label>
    <button id="startBtn">Start</button>
    <button id="modeBtn" disabled>Flag Mode: Off</button>
  </div>
  <div id="status"></div>
  <div id="board"></div>
  <script>
    const rowsInput = document.getElementById('rows');
    const colsInput = document.getElementById('cols');
    const startBtn = document.getElementById('startBtn');
    const modeBtn = document.getElementById('modeBtn');
    const statusElem = document.getElementById('status');
    const boardElem = document.getElementById('board');

    let rows = 0, cols = 0, mines = 0;
    let cells = [];
    let flagMode = false;

    startBtn.onclick = () => {
      rows = parseInt(rowsInput.value, 10);
      cols = parseInt(colsInput.value, 10);
      mines = Math.floor(rows * cols * 0.15);
      startGame();
    };

    modeBtn.onclick = () => {
      flagMode = !flagMode;
      modeBtn.textContent = `Flag Mode: ${flagMode ? 'On' : 'Off'}`;
    };

    function startGame() {
      flagMode = false;
      modeBtn.textContent = 'Flag Mode: Off';
      modeBtn.disabled = false;
      statusElem.textContent = `Mines: ${mines}`;
      boardElem.innerHTML = '';

      cells = Array.from({ length: rows }, () =>
        Array.from({ length: cols }, () => ({
          mine: false,
          adj: 0,
          revealed: false,
          flagged: false
        }))
      );

      let placed = 0;
      while (placed < mines) {
        const r = Math.floor(Math.random() * rows);
        const c = Math.floor(Math.random() * cols);
        if (!cells[r][c].mine) {
          cells[r][c].mine = true;
          placed++;
          for (let dr = -1; dr <= 1; dr++) {
            for (let dc = -1; dc <= 1; dc++) {
              const nr = r + dr, nc = c + dc;
              if (nr >= 0 && nr < rows && nc >= 0 && nc < cols) {
                cells[nr][nc].adj += 1;
              }
            }
          }
        }
      }

      boardElem.style.gridTemplateColumns = `repeat(${cols}, 32px)`;
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          const div = document.createElement('div');
          div.className = 'cell hidden';
          div.addEventListener('click', () => handleCell(r, c));
          cells[r][c].elem = div;
          boardElem.appendChild(div);
        }
      }
    }

    function handleCell(r, c) {
      const cell = cells[r][c];
      if (cell.revealed) return;
      if (flagMode) {
        cell.flagged = !cell.flagged;
        cell.elem.className = `cell hidden ${cell.flagged ? 'flagged' : ''}`;
        return;
      }
      if (cell.flagged) return;
      reveal(r, c);
    }

    function reveal(r, c) {
      const cell = cells[r][c];
      if (cell.revealed || cell.flagged) return;
      cell.revealed = true;
      if (cell.mine) {
        cell.elem.className = 'cell revealed mine';
        statusElem.textContent = 'Game Over!';
        showAll();
        return;
      }
      cell.elem.className = 'cell revealed';
      if (cell.adj > 0) {
        cell.elem.textContent = cell.adj;
      } else {
        for (let dr = -1; dr <= 1; dr++) {
          for (let dc = -1; dc <= 1; dc++) {
            const nr = r + dr, nc = c + dc;
            if (nr >= 0 && nr < rows && nc >= 0 && nc < cols) {
              reveal(nr, nc);
            }
          }
        }
      }
      checkWin();
    }

    function showAll() {
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          const cell = cells[r][c];
          if (cell.mine) {
            cell.elem.className = 'cell revealed mine';
          } else if (!cell.revealed) {
            cell.elem.className = 'cell revealed';
            if (cell.adj > 0) cell.elem.textContent = cell.adj;
          }
        }
      }
    }

    function checkWin() {
      let ok = true;
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          const cell = cells[r][c];
          if (!cell.mine && !cell.revealed) ok = false;
        }
      }
      if (ok) {
        statusElem.textContent = 'You Win!';
        showAll();
      }
    }
  </script>
</body>
</html>
